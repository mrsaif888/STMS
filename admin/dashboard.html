<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="../assets/style.css" />
  <body>
    <div class="admin-dashboard">
      <h1>Admin Dashboard</h1>
      <div class="dashboard-grid">
        <div class="dashboard-left">
      <div class="admin-section create-user">
        <h2>Create New User</h2>
        <form id="create-user-form">
            <input type="text" id="new-username" />
            <input type="password" id="new-password" />
            <select id="new-role">
              <option value="user">User</option>
            </select>
          <button type="submit">Create User</button>
        </form>
      </div>
  
      <div class="admin-section assign-team-lead">
        <h2>Assign Team Lead</h2>
        <select id="team-lead-selection"></select>
        <button id="assign-team-lead-btn">Assign as Team Lead</button>
      </div>
  </div>
  <div class="dashboard-right">
      <div class="admin-section create-task">
        <h2>Create Task</h2>
        <form id="create-task-form">
          <input type="text" placeholder="Task Title" required />
          <textarea placeholder="Task Description"></textarea>
          <input type="date" />
          <select>
            <option value="high">High Priority</option>
            <option value="medium">Medium Priority</option>
            <option value="low">Low Priority</option>
          </select>
          <select>
            <option value="user1">User 1</option>
          </select>
          <button type="submit">Create Task</button>
        </form>
      </div>
  
      <div class="admin-section task-board">
        <h2>Task Board</h2>
        <div class="kanban-board">
          <div class="kanban-column" id="todo"><h3>To Do</h3></div>
          <div class="kanban-column" id="in-progress"><h3>In Progress</h3></div>
          <div class="kanban-column" id="completed"><h3>Completed</h3></div>
        </div>
      </div>
    </div>
    </div>
    </div>

  <script>
    document.getElementById("create-user-form").addEventListener("submit", function (e) {
      e.preventDefault();
    
      const username = document.getElementById("new-username").value;
      const password = document.getElementById("new-password").value;
      const role = document.getElementById("new-role").value;
    
      fetch("../backend/create_user.php", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}&role=${encodeURIComponent(role)}`
      })
      .then(res => res.json())
      .then(data => {
        alert(data.message);
        if (data.success) {
          document.getElementById("create-user-form").reset();
          loadUsersForTeamLead(); // Optional: reload team lead dropdown
        }
      })
      .catch(err => {
        console.error("User creation error:", err);
        alert("Something went wrong.");
      });
    });

    document.addEventListener("DOMContentLoaded", () => {
  const assignBtn = document.getElementById("assign-team-lead-btn");
  if (assignBtn) {
    assignBtn.addEventListener("click", function () {
      const selectedUserId = document.getElementById("team-lead-selection").value;

      fetch("../backend/assign_team_lead.php", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded"
        },
        body: `user_id=${encodeURIComponent(selectedUserId)}`
      })
        .then(res => res.json())
        .then(data => {
          alert(data.message);
          if (data.success) loadUsersForTeamLead();
        })
        .catch(err => {
          console.error("Assign failed:", err);
        });
    });
  } else {
    console.warn("⚠️ Button not found in DOM.");
  }

  loadUsersForTeamLead();
});



function loadUsersForTeamLead() {
  fetch("../backend/get_users.php")
    .then(res => res.json())
    .then(data => {
      console.log("Fetched users:", data.users); // ✅ log the array

      const dropdown = document.getElementById("team-lead-selection");
      console.log("Dropdown element:", dropdown); // ✅ check if it exists

      if (!dropdown) {
        alert("Dropdown not found. Check the ID!");
        return;
      }

      dropdown.innerHTML = "";

      if (data.users.length === 0) {
        const option = document.createElement("option");
        option.textContent = "No users available";
        option.disabled = true;
        dropdown.appendChild(option);
        return;
      }

      data.users.forEach(user => {
        const option = document.createElement("option");
        option.value = user.id;
        option.textContent = user.username;
        dropdown.appendChild(option);
      });
    })
    .catch(err => {
      console.error("Failed to load users:", err);
    });
}

    </script>
      </body>
</html>
